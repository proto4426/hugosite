---
title: "API packages"
author: "Mark Hagemann"
date: "February 23, 2016"
output: 
  html_document:
    self_contained: false
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>


<p>I’m taking a break from helping <a href="http://www.science.smith.edu/datafest/">DataFest</a> participants untangle their R code to work on clearing my backlog of unfinished blog posts. One thing I’ve been meaning to talk about is a series of R packages I’ve written, in various stages of development. This is something I’ve <a href="https://github.com/markwh">done before</a>, but still new enough to be excited about a working product.</p>
<p>All these packages are built to access data from US Federal agency APIs. The first two came out of my interest beginning several months back in environmental regulatory and oversight data, mostly related to the <a href="http://flintwaterstudy.org/">water crisis in Flint</a>. The APIs they access are <a href="https://www3.epa.gov/enviro/">envirofacts</a> from the EPA and <a href="https://www.regulations.gov/#!home">regulations.gov</a> from various Federal agencies. Both of these packages have working functions, but the data structures they return, and the structure of the APIs themselves, are complicated enough to keep me from doing anything very interesting with them. So far. The versions on github <a href="https://github.com/markwh/envirofacts">here</a> and <a href="https://github.com/markwh/regsgov">here</a> are functional but not elegant. And since I don’t know particularly what to do with them, I probably won’t be working on them further in the forseeable future. I’d love to hear ideas though.</p>
<p>The <a href="https://github.com/markwh/streamstats">final package</a>–the one I’m most excited about–is one to access the <a href="http://water.usgs.gov/osw/streamstats/">USGS Streamstats</a> API. I’ts probably the most professional-looking R package I’ve written to date (though that’s not saying much). What’s it do? Well the main function, <code>delineateWatershed</code>, takes a location (latitude and longitude), and returns a <a href="http://geojson.org/">geojson</a> of that location’s contributing watershed. It can also return watershed parameters like basin size and land-use composition as well as streamflow statistics. Of course, all of this is being computed or looked up on USGS servers; the package just makes the call to retrieve this info. But it’s still a very handy way to get this data into R, and I’m already using this for my own research projects.</p>
<p>Aside from the simple bindings to the API endpoints, I also have some minimal additional features for convenience. <code>combineWatersheds</code> creates a single watershed object with geojson data composed of multiple supplied watersheds. <code>writeGeoJSON</code> writes the geojson data to disk, for example to export into a different program like ArcGIS. And <code>leafletWatershed</code> makes a slick <a href="http://leafletjs.com/">leaflet</a> map of a watershed object. Here’s an example:</p>
<pre class="r"><code>library(streamstats)
library(leaflet)
data(westfield)
leafletWatershed(westfield) %&gt;% 
  setView(lng = -72.92488, 42.31705, zoom = 12)</code></pre>
<pre><code>## Warning: Unknown or uninitialised column: &#39;ID&#39;.</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"calls":[{"method":"addTiles","args":["http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"maxNativeZoom":null,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"continuousWorld":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addGeoJSON","args":[{"type":"FeatureCollection","crs":{"type":"ESPG","properties":{"code":4326}},"features":[{"properties":{"DRFTPERSTR":0.0187109433018,"D70":0,"ORIG_FID":1,"M7D2Y":0,"ACRSDFT":1.17668378032,"D75":0,"AUGD50":0,"BSLDEM250":7.802146,"MAREGION":1,"BSLDEM10M":13.35867,"MinSimpTol":0.000269796613823,"HydroID":2,"D50":0,"LAKEAREA":0.355180471155,"MaxSimpTol":0.000269796613823,"LC11DEV":3.20639344785,"Shape_Area":100315398.27,"D98":0,"D99":0,"OUTLETX":82544.9999932,"OUTLETY":897264.999993,"D95":0,"D90":0,"warningmsg":" ","BFFLOW":0,"RELATEDOID":" ","FOREST":89.9284455397,"ELEV":1564.3292401,"DRNAREA":38.7357667641,"M7D10Y":0,"edited":0,"Name":"ags101","OBJECTID":1,"STRMTOT":62.887464375,"CENTROIDX":77170.744321,"PROBPEREN":0,"BFWDTH":0,"Descript":"W01080206","GlobalWshd":1,"BFDPTH":0,"DrainID":2,"FID":0,"Shape_Leng":71160.045,"CENTROIDY":905814.344185,"D60":0,"BFAREA":0,"MAXTEMPC":12.28968,"ExcludeCod":0,"D85":0,"IMPNLCD11":0,"CRSDFT":3.0347345168,"HUCID":"71160.0449999794","D80":0,"LC11IMP":0.1881759,"PRECPRIS00":55.70748,"WETLAND":3.65478013302,"URBNLCD11":0,"numVert":4370},"type":"Feature","bbox":[-72.9173511984142,42.4772577139766,-73.0539365536689,42.3137626131855],"geometry":{"type":"Polygon","coordinates":[[[-73.0538128413323,42.4367114720972],[-73.0539365536689,42.4367998703953],[-73.0538150558746,42.4368015100993],[-73.0538128413323,42.4367114720972]],[[-72.9800999018781,42.4553304071041],[-72.9801020110723,42.4554204066912],[-72.9799804205097,42.455421969191],[-72.9800999018781,42.4553304071041]],[[-72.9800999018781,42.4553304071041],[-72.9799319075603,42.4533516799452],[-72.9787894836119,42.4512954791704],[-72.979003084537,42.4500321742116],[-72.9804215237891,42.4483031774034],[-72.9801193657382,42.4457859738253],[-72.9793395579892,42.4436350498686],[-72.9795151741164,42.4407515194865],[-72.9752743582221,42.4413461675714],[-72.9714546118642,42.4391440740763],[-72.9700717581038,42.4371808462576],[-72.9701241348436,42.434208878687],[-72.9669355009803,42.4329889850495],[-72.9665438056852,42.4318234754734],[-72.964671088268,42.4296863697784],[-72.9627041021123,42.428720931831],[-72.9613342372048,42.4272976718522],[-72.9612842753357,42.4251373597604],[-72.9629685687501,42.4243956383033],[-72.9643764418688,42.422216788461],[-72.9647726656735,42.4183400574187],[-72.9636480451746,42.4170037676995],[-72.9658956599254,42.4143640001495],[-72.9653909377735,42.4135600699905],[-72.9652256554969,42.4116713378029],[-72.9624762543019,42.4083748087817],[-72.9616995897882,42.4063137468107],[-72.9587387894022,42.4043704513184],[-72.9573529924243,42.4022270527251],[-72.957784809759,42.3998805324917],[-72.9599251347217,42.397872491689],[-72.9571890598985,42.3951159472068],[-72.9575222472029,42.3937611257706],[-72.9571258275982,42.387103166052],[-72.9584677304933,42.3873562824272],[-72.960245430476,42.3854428879714],[-72.9574153989941,42.3838580104876],[-72.9544931033923,42.3835348469388],[-72.9532499391232,42.3822899817884],[-72.9528008994556,42.3786039907643],[-72.9506895152435,42.3765597364417],[-72.949895051402,42.3736884515393],[-72.9485184218559,42.3719049762894],[-72.9484689414787,42.3697446305115],[-72.9465595545664,42.3658968981225],[-72.9465451436087,42.3652668087045],[-72.9472631348353,42.3648075609386],[-72.9457283772021,42.3614053129983],[-72.9432187170683,42.3578352287425],[-72.9425687503194,42.3559524940537],[-72.9409910370935,42.3559722758034],[-72.9384035005426,42.3542939148529],[-72.9370296623501,42.3526003362757],[-72.933206409821,42.3499467999918],[-72.9329229104077,42.3481495490485],[-72.9300870929848,42.3462039385164],[-72.9298098007934,42.34467668553],[-72.927494154205,42.3442552833764],[-72.9277002933957,42.3426319937986],[-72.9268305874619,42.3417423604406],[-72.9267493956473,42.3381417571346],[-72.9253721615832,42.3362679498597],[-72.9240376048288,42.3362844898659],[-72.923883833251,42.3348457561915],[-72.9230062444287,42.3335960425441],[-72.9217970916584,42.3337910991528],[-72.9210105393757,42.3311896326212],[-72.9209640506734,42.3291192590218],[-72.9190938383189,42.3268913592629],[-72.9188209853688,42.3255441175399],[-72.9173511984142,42.3249319414036],[-72.9175816777109,42.324388854507],[-72.9197591425177,42.3240918539587],[-72.9204728209919,42.3234527638666],[-72.9200725604403,42.3218369753896],[-72.9185725316272,42.3198745757845],[-72.9182977032556,42.3184373272693],[-72.9203576737723,42.3183218573782],[-72.920951976103,42.3177742651117],[-72.9239842905372,42.3177367316035],[-72.9257752704057,42.3164539380538],[-72.9283223293706,42.316422308751],[-72.9317826977034,42.3138580699365],[-72.9394235483522,42.3137626131855],[-72.9423507492773,42.3144462532901],[-72.9444844969611,42.3175709122875],[-72.9464498612048,42.3186266883231],[-72.9498769547097,42.3199341229635],[-72.9530388968448,42.3202543412288],[-72.955257394905,42.3217569893764],[-72.9567865992367,42.3196666472364],[-72.9592124965148,42.3196358706102],[-72.9616591775026,42.3205052207757],[-72.962723793734,42.3193211088793],[-72.9641730651709,42.3190325278617],[-72.9674813559664,42.3204310245798],[-72.9720926818853,42.3204620790867],[-72.9751733480199,42.3224935514402],[-72.981100123293,42.3216969764072],[-72.9826938925961,42.3223967747042],[-72.9861578719443,42.3252333901733],[-72.9867855547727,42.3261256786165],[-72.9868088169552,42.3271158515015],[-72.9857677679517,42.3292903191202],[-72.9895940941834,42.3320321198684],[-72.9914605217756,42.3339888262841],[-72.9956301333391,42.3358255317619],[-73.0024627580927,42.3373571871884],[-73.0053710747801,42.3422714760835],[-73.0088285713174,42.3447473143167],[-73.0109644717844,42.3477807179142],[-73.0107346577667,42.3483239896559],[-73.0112609380224,42.3500278566708],[-73.0104372357991,42.3511192226908],[-73.0102267982012,42.3524726144793],[-73.0107358483287,42.3534563623472],[-73.0119687680022,42.3542505331398],[-73.0121052255091,42.3548790587871],[-73.0104298071609,42.3558915510281],[-73.0103235056377,42.3565232274568],[-73.0113158827861,42.3574105938649],[-73.012887205715,42.3571198054068],[-73.0135005058919,42.3573818611049],[-73.0148721325318,42.358894523683],[-73.0143084270039,42.3607027973769],[-73.017496436296,42.3620113998831],[-73.0182657311483,42.3637120280814],[-73.0193754746294,42.3644177196365],[-73.0186925422733,42.3663176165895],[-73.0198044989722,42.3671133043628],[-73.0198412718994,42.3686435404644],[-73.0234069709959,42.3704872426578],[-73.0233267957141,42.3721991245367],[-73.0253276863533,42.374603733218],[-73.0266717693409,42.3749460552816],[-73.0278727388418,42.3743898584859],[-73.0295722638852,42.3743672708518],[-73.0301879800789,42.3747192355152],[-73.0309577717023,42.3764198118875],[-73.030433530739,42.3798483870564],[-73.0318693426006,42.3839711798807],[-73.0331315485283,42.3859353079708],[-73.033281328012,42.3871038389728],[-73.0337735470671,42.3873674034042],[-73.0336805278225,42.3885392096985],[-73.035651719142,42.3896834439739],[-73.0353071138643,42.3904984165689],[-73.0363135531897,42.3919256732839],[-73.0385102562556,42.3923465025633],[-73.0395080286391,42.3934136553799],[-73.0395540628448,42.3953039510228],[-73.0389687713313,42.3962121830153],[-73.0394830053065,42.3973758298566],[-73.0365432640152,42.4013769585216],[-73.0386232475114,42.4019794814779],[-73.0405949473857,42.4031236274666],[-73.0406695435226,42.4061840616252],[-73.0382109309611,42.4099986813628],[-73.0352224141844,42.4120194770558],[-73.0345241961715,42.41328937675],[-73.0346981111801,42.4154480430138],[-73.0380414871489,42.4180146193622],[-73.0380546317822,42.4185546884737],[-73.0364042029936,42.4206476861055],[-73.0356456929304,42.4244395250699],[-73.0368781214712,42.4251434178623],[-73.0372885925476,42.4270287940761],[-73.0399988806104,42.428523276629],[-73.0417086954598,42.4288605421109],[-73.0430275910191,42.4281225333018],[-73.0448588941073,42.4284581616831],[-73.0495576102488,42.4317265167995],[-73.0500679652479,42.432710109518],[-73.0525445529861,42.4345676002071],[-73.0538128413323,42.4367114720972],[-73.0513559719635,42.4356641126287],[-73.049535463516,42.4357786943752],[-73.0477281804746,42.4364332749847],[-73.0458323451466,42.4384396668397],[-73.0479731886652,42.4414722769878],[-73.0528233152203,42.4459090228721],[-73.0535857272822,42.4472493492727],[-73.053607867461,42.4481494835751],[-73.0523085859008,42.4496976697932],[-73.0490556678721,42.4509120234246],[-73.046436764977,42.4531982171309],[-73.046843295187,42.4549035522607],[-73.0496610817425,42.4557660639104],[-73.0482598172884,42.4581259719612],[-73.0498090745349,42.4617968015185],[-73.0493979209909,42.4648636877894],[-73.0489226429397,42.4653202930332],[-73.0512900278957,42.4676294938926],[-73.0517034190257,42.469604796555],[-73.0495746270653,42.4720645323222],[-73.0474081134952,42.4729940793068],[-73.0488892826034,42.4738745619069],[-73.0491478833732,42.4745013917161],[-73.0445803227386,42.4767236741645],[-73.0421484861872,42.4767562506302],[-73.0390537514593,42.4745466134941],[-73.0327550915663,42.4756210341956],[-73.0308984773734,42.4742951246221],[-73.0300451885328,42.474216434291],[-73.0269252126201,42.4759685649684],[-73.0259829128364,42.4772416155809],[-73.0247669801316,42.4772577139766],[-73.0236617632779,42.4768221258278],[-73.0222764623534,42.4748595834],[-73.0180493361075,42.471043637492],[-73.0163255357183,42.4701659582772],[-73.0154420755969,42.4688269923589],[-73.0128543547787,42.4674203477963],[-73.0120947188754,42.4661697560949],[-73.0118020411756,42.4641027164333],[-73.0099332892435,42.4622363596345],[-73.0048210034367,42.4620331423625],[-73.001135498272,42.4604605232278],[-72.9986572187189,42.4585119421076],[-72.9967122813527,42.4585372322742],[-72.995703544133,42.4570196546053],[-72.9911953282425,42.4566279005705],[-72.989092774019,42.4551244627048],[-72.9886920452814,42.4535989611544],[-72.9873380150901,42.452896127859],[-72.9864871878817,42.4529071126328],[-72.9850539950468,42.4540060729827],[-72.9827508241913,42.4543058660738],[-72.9800999018781,42.4553304071041]]]}}]},null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2,"dashArray":null,"smoothFactor":1,"noClip":false}]},{"method":"addMarkers","args":[42.3170503170802,-72.9248787646941,null,null,null,{"clickable":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null]}],"limits":{"lat":[42.3170503170802,42.3170503170802],"lng":[-72.9248787646941,-72.9248787646941]},"setView":[[42.31705,-72.92488],12,[]]},"evals":[],"jsHooks":[]}</script>
<p>I may add more functions for doing common analysis-type things with streamstats data, but I currently have none planned.</p>
<p>I would love to see people try these packages out and contribute on GitHub by opening an issue or submitting a pull request.</p>
